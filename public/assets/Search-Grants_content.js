NWS.initNamespace("NWS.Block.DataList",function(){var _={AjaxCompleteNotifier:new NWS.Util.Notifier("AjaxComplete")};return{Init:function(jsModules,callbacks){NWS.Modules.LoadResources(jsModules,callbacks)},OnAjaxComplete:function(who,callback,callbackArgs){_.AjaxCompleteNotifier.Subscribe(who,callback,callbackArgs)},OpenEditor:function(path,itemID){var args={Title:itemID===-1?"Create New":"Editing",Path:path};NWS.Wkst.Dialog.Open("","/DataEditorDialog?DataID="+itemID,args)},GetBlockID:function(blockDataFieldID){var idx=String(blockDataFieldID).lastIndexOf("_");if(idx===-1)return blockDataFieldID;return blockDataFieldID.substring(0,idx)},GetKeywordCtl:function(prefix){return document.getElementById(prefix+"keywordFilter")},GetPageNumCtl:function(prefix){return document.getElementById(prefix+"PageNum")},GetResultsDiv:function(blockID){return document.getElementById("F"+blockID+"_ResultsDiv")},GetTagFieldset:function(blockID,classID){return document.getElementById(NWS.Block.DataList.MakeFullPrefix(blockID,classID)+"fieldset")},MakePrefix:function(blockID){return"F"+String(blockID)+"_"},MakeFullPrefix:function(blockID,classID){return NWS.Block.DataList.MakePrefix(blockID)+"C"+String(classID)+"_"},KeywordFilter:function(blockID){var blockPrefix=NWS.FilterSupport.FilterBlock.MakePrefix(blockID),keywordCtl=NWS.FilterSupport.FilterBlock.GetKeywordCtl(blockPrefix);NWS.FilterSupport.RequeryTimer.KeyUp(keywordCtl,NWS.Block.DataList.ClassificationCheck,[blockID])},ResetAllClassifications:function(blockID,docID,evt){evt.preventDefault();var prefix=NWS.Block.DataList.MakePrefix(blockID),filterBlock=NWS.Util.Get("FilterArea_"+prefix),fieldsets=NWS.Util.QueryGetAll("fieldset",filterBlock);for(var i=0;i<fieldsets.length;i++){var classID=fieldsets[i].getAttribute("classid"),dataField=fieldsets[i].getAttribute("dataField"),classes=fieldsets[i].getAttribute("class");if(classes==="keyword"){var keywordInput=NWS.Util.QueryGet(".input input[type='text']",fieldsets[i]);keywordInput.value="";continue}if(classes==="calendar"){var start=NWS.Util.Get(NWS.Block.DataList.MakePrefix(blockID)+"OrigStart"),today=(start&&start.value)?new Date(start.value):new Date,firstOfMonth=new Date(today.getFullYear(),today.getMonth(),1);NWS.Util.Get(NWS.Block.DataList.MakePrefix(blockID)+"Start").value=String(today.getMonth()+1)+"/"+today.getDate()+"/"+today.getFullYear();var calendarWidget=NWS.Util.Get("widget"+blockID);if(calendarWidget){calendarWidget.setAttribute("selectedDate",today.toString());NWS.FilterSupport.CalendarFilter.WidgetInit(blockID)}else{var from=NWS.Util.Get("F"+blockID+"_calendarFrom"),to=NWS.Util.Get("F"+blockID+"_calendarTo");from.value=to.value=""}continue}if(classes!==null&&classes.indexOf("tagSuggest")>-1){NWS.FilterSupport.TagSuggest.Reset(blockID,classID,"DataList_",evt);continue}if(classID!==null&&dataField!==null&&blockID.indexOf("_DF")===-1){NWS.FilterSupport.FilterBlock.ResetSelections([blockID,"_DF",dataField].join(""),classID)}else if(classID!==null){NWS.FilterSupport.FilterBlock.ResetSelections(blockID,classID)}else{var checkboxes=NWS.Util.QueryGetAll("input[type='checkbox']",fieldsets[i]);for(var j=0;j<checkboxes.length;j++)checkboxes[j].checked=false;var select=NWS.Util.QueryGet("select",fieldsets[i]);if(select)select.selectedIndex="0"}}var pageNumCtl=NWS.Block.DataList.GetPageNumCtl(prefix);if(pageNumCtl&&pageNumCtl.value)pageNumCtl.value=1;docID=NWS.Util.Get(prefix+"DocID").value;NWS.Block.DataList.Submit(blockID,docID)},ResetClassificationCheckbox:function(blockDataFieldID,classID,evt){if(evt&&evt.preventDefault)evt.preventDefault();NWS.FilterSupport.FilterBlock.ResetSelections(blockDataFieldID,classID);var blockID=NWS.Block.DataList.GetBlockID(blockDataFieldID),docID=NWS.Util.Get(NWS.Block.DataList.MakePrefix(blockID)+"DocID").value;NWS.Block.DataList.Submit(blockID,docID)},ResetClassificationLink:function(blockDataFieldID,classID,evt){if(evt&&evt.preventDefault)evt.preventDefault();NWS.Block.DataList.ResetClassificationCheckbox(blockDataFieldID,classID)},ResetSelectClass:function(target,selected,blockID,classID){if(selected)document.getElementById(target.id+"_div").classList.add("selected");else document.getElementById(target.id+"_div").classList.remove("selected");NWS.Block.DataList.CollapseTagSet(blockID,classID,selected)},ClassificationCheck:function(blockDataFieldID){var blockID=NWS.Block.DataList.GetBlockID(blockDataFieldID),prefix=NWS.FilterSupport.FilterBlock.MakePrefix(blockID);var pageNumCtl=NWS.FilterSupport.FilterBlock.GetPageNumCtl(prefix);if(pageNumCtl&&pageNumCtl.value)pageNumCtl.value=1;var docID=NWS.Util.Get(prefix+"DocID").value;NWS.Block.DataList.Submit(blockID,docID)},ClassificationLinkSelect:function(blockDataFieldID,classID,container,evt){NWS.FilterSupport.FilterBlock.HandleCommonLinkSelect(blockDataFieldID,classID,container,evt);NWS.Block.DataList.ClassificationCheck(blockDataFieldID)},ClassificationSelectChange:function(blockDataFieldID){NWS.Block.DataList.ClassificationCheck(blockDataFieldID)},ClassificationDynamicCheck:function(blockDataFieldID,classID,ctl){NWS.Block.DataList.ResetSelectClass(ctl,ctl.checked,blockDataFieldID,classID);NWS.Block.DataList.ClassificationCheck(blockDataFieldID)},ClassificationMinMax:function(blockID,classID){NWS.FilterSupport.FilterBlock.ClassificationMinMax(blockID,classID)},SeeAllLess:function(blockID,classID,evt){if(evt&&evt.preventDefault)evt.preventDefault();NWS.FilterSupport.FilterBlock.SeeAllLess(blockID,classID)},CollapseTagSet:function(blockID,classID,turnOn){var fieldset=NWS.Block.DataList.GetTagFieldset(blockID,classID);if(!fieldset)return;if(fieldset.getAttribute("runaway")!=="1")return;if(turnOn)fieldset.classList.add("min");else fieldset.classList.remove("min")},BrowserLocation:function(blockID,docID,callback,callbackArgs){var Found=function(position){var baseID=NWS.Block.DataList.MakePrefix(blockID);NWS.Util.Get(baseID+"latitude").value=position.coords.latitude;NWS.Util.Get(baseID+"longitude").value=position.coords.longitude;NWS.Util.Get(baseID+"location").value="My Location";NWS.Modules.ExecuteFunctionByName(callback,window,callbackArgs)};var NotFound=function(positionError){if(positionError.code===2)alert("Unable to determine your current location");callback.apply(window,callbackArgs)};if("geolocation"in navigator)navigator.geolocation.getCurrentPosition(Found,NotFound,{enableHighAccuracy:false,maximumAge:300000})},RadiusFilter:function(blockID){var prefix=NWS.Block.DataList.MakePrefix(blockID),docID=NWS.Util.Get(prefix+"DocID").value;if(NWS.Util.Get(prefix+"latitude").value===""||NWS.Util.Get(prefix+"longitude").value==="")return;NWS.Block.DataList.GetPageNumCtl(prefix).value="1";NWS.Block.DataList.Submit(blockID,docID)},ReCheck:function(blockID,docID){var skipResubmit=NWS.Block.DataList.GetResultsDiv(blockID)&&!NWS.FilterSupport.FilterBlock.ResubmitCheckForChanges(blockID),prefix=NWS.Block.DataList.MakePrefix(blockID),calendarWidget=NWS.Util.Get("widget"+blockID),sortKeyCtl=NWS.Util.Get(prefix+"SortKey"),sortDirCtl=NWS.Util.Get(prefix+"SortDir");if(calendarWidget&&calendarWidget.hasAttribute("doInit")){NWS.FilterSupport.CalendarFilter.WidgetInit(blockID);calendarWidget.removeAttribute("doInit")}if(!sortKeyCtl||!sortDirCtl)return;var selectedKey=sortKeyCtl.value,selectedDir=sortDirCtl.value;var lis=NWS.Util.Get(prefix+"SortList").getElementsByTagName("LI");for(var ii=0;ii<lis.length;++ii)if(lis[ii].getAttribute("sortKey")===selectedKey&&lis[ii].getAttribute("sortDir")===selectedDir)lis[ii].classList.add("selected");else lis[ii].classList.remove("selected");if(skipResubmit)return NWS.Block.DataList.AjaxComplete(blockID,null,null,null);else return NWS.Block.DataList.Submit(blockID,docID)},PageEvent:function(blockID,docID,newPageNum,evt){if(evt&&evt.preventDefault)evt.preventDefault();var prefix=NWS.Block.DataList.MakePrefix(blockID);NWS.Block.DataList.GetPageNumCtl(prefix).value=String(newPageNum);NWS.Block.DataList.Submit(blockID,docID);return false},ChangeSortOrder:function(blockID,docID,evt){var target=evt.target;if(!target)return;while(target&&target.tagName!=="LI")target=target.parentNode;if(!target)return;if(target.classList.contains("selected"))return;var prefix=NWS.Block.DataList.MakePrefix(blockID);var lis=NWS.Util.Get(prefix+"SortList").getElementsByTagName("LI");for(var ii=0;ii<lis.length;++ii)lis[ii].classList.remove("selected");target.classList.add("selected");NWS.Util.Get(prefix+"SortKey").value=target.getAttribute("sortKey");NWS.Util.Get(prefix+"SortDir").value=target.getAttribute("sortDir");NWS.Block.DataList.GetPageNumCtl(prefix).value="1";NWS.Block.DataList.Submit(blockID,docID)},AjaxComplete:function(blockID,ajaxResult){var resultsArea=NWS.Block.DataList.GetResultsDiv(blockID);if(!resultsArea)return;var response=ajaxResult===null?null:ajaxResult.response;if(response&&response.javascript){var arrOfDates=new Function('"use strict"; return ('+response.javascript+')')();NWS.FilterSupport.CalendarFilter.SelectDates("widget"+blockID,arrOfDates)}if(response&&response.htmlData)resultsArea.innerHTML=response.htmlData;if(response&&response.suggestionUpdates)NWS.FilterSupport.FilterBlock.UpdateFilterSuggestions(blockID,response.suggestionUpdates);if(response&&response.filterUpdateArray)NWS.FilterSupport.FilterBlock.UpdateFilterCounts(blockID,response.filterUpdateArray);else NWS.FilterSupport.FilterBlock.ResetFieldsetState(blockID);NWS.FilterSupport.FilterBlock.ShowHideWaiting(blockID,false);_.AjaxCompleteNotifier.Notify(resultsArea)},Submit:function(blockID,docID){var prefix=NWS.Block.DataList.MakePrefix(blockID),pageNumCtl=NWS.Block.DataList.GetPageNumCtl(prefix),sortKeyCtl=NWS.Util.Get(prefix+"SortKey"),sortDirCtl=NWS.Util.Get(prefix+"SortDir"),keywordCtl=NWS.Block.DataList.GetKeywordCtl(prefix),startCtl=NWS.Util.Get(prefix+"Start"),endCtl=NWS.Util.Get(prefix+"End"),widget=NWS.Util.Get("widget"+blockID),widgetDate=widget&&widget.hasAttribute("currentMonth")?new Date(widget.getAttribute("currentMonth")):null,latitudeCtl=NWS.Util.Get(prefix+"latitude"),longitudeCtl=NWS.Util.Get(prefix+"longitude"),radiusCtl=NWS.Util.Get(prefix+"radius"),queryArgs={pageNumber:pageNumCtl&&pageNumCtl.value?pageNumCtl.value:"1",sortKey:sortKeyCtl?sortKeyCtl.value:"",sortDirection:sortDirCtl?sortDirCtl.value:"",keyword:keywordCtl?keywordCtl.value.replace(/&/g,"&amp;"):"",classifications:NWS.FilterSupport.FilterBlock.FormatClassifications(prefix),startDate:startCtl?startCtl.value:"",endDate:endCtl?endCtl.value:"",widgetDate:widgetDate!==null?String(widgetDate.getMonth()+1)+"/"+String(widgetDate.getDate())+"/"+String(widgetDate.getFullYear()):"",latitude:latitudeCtl&&latitudeCtl.value?latitudeCtl.value:"NaN",longitude:longitudeCtl&&longitudeCtl.value?longitudeCtl.value:"NaN",radius:radiusCtl?radiusCtl.value:"NaN",userRanges:NWS.FilterSupport.UserRanges.FormatUserRanges(blockID)},args={docID:parseInt(docID),blockID:blockID,queryData:queryArgs},callback=NWS.Ajax.QueuedCallback("DataList_Main"+blockID,function(result){NWS.Block.DataList.AjaxComplete(blockID,result)});NWS.FilterSupport.FilterBlock.ShowHideWaiting(blockID,true);NWS.Ajax.Post("/DataAjax/GetDataListResults",args,"json",callback)}}})